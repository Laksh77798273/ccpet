#!/usr/bin/env node

/**
 * ccpet-check - æ‰‹åŠ¨æŸ¥çœ‹å® ç‰©çŠ¶æ€ï¼Œä¸æ¶ˆè€—Claude Code token
 * ç”¨æ³•: npx ccpet-check æˆ– node bin/ccpet-check
 */

const { ClaudeCodeStatusLine } = require('../dist/ccpet');

async function checkPetStatus() {
  try {
    console.log('ğŸ¾ æ£€æŸ¥å® ç‰©çŠ¶æ€...\n');
    
    const statusLine = new ClaudeCodeStatusLine();
    const display = statusLine.getStatusDisplay();
    statusLine.saveState();
    
    console.log(display);
    console.log('\nğŸ’¡ æç¤º: è¿™æ¬¡æŸ¥çœ‹ä¸æ¶ˆè€—Claude Code token');
    console.log('ğŸ“ åœ¨Claude Codeä¸­æ´»è·ƒä½¿ç”¨å¯ä»¥å–‚å…»ä½ çš„å® ç‰©');
    
    // æ˜¾ç¤ºè·ç¦»ä¸Šæ¬¡å–‚é£Ÿçš„æ—¶é—´
    const petState = statusLine.pet ? statusLine.pet.getState() : null;
    if (petState && petState.lastFeedTime) {
      const timeSinceLastFeed = Date.now() - new Date(petState.lastFeedTime).getTime();
      const minutes = Math.floor(timeSinceLastFeed / (1000 * 60));
      const hours = Math.floor(minutes / 60);
      
      if (hours > 0) {
        console.log(`â° è·ç¦»ä¸Šæ¬¡å–‚é£Ÿ: ${hours}å°æ—¶${minutes % 60}åˆ†é’Ÿå‰`);
      } else {
        console.log(`â° è·ç¦»ä¸Šæ¬¡å–‚é£Ÿ: ${minutes}åˆ†é’Ÿå‰`);
      }
    }
    
  } catch (error) {
    console.error('âŒ æ£€æŸ¥å® ç‰©çŠ¶æ€å¤±è´¥:', error.message);
    process.exit(1);
  }
}

if (require.main === module) {
  checkPetStatus();
}